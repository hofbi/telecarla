name: CI

on: [push, pull_request]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Set up Python 3.8
      uses: actions/setup-python@v1
      with:
        python-version: 3.8
    - name: Install dependencies
      run: |
        sudo snap install shfmt
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    - name: Check
      run: make check

  ros:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        ros_distribution:
        - melodic
        include:
        - docker_image: ubuntu:bionic
          ros_distribution: melodic
          ros_version: 1
    steps:
    - uses: ros-tooling/setup-ros@0.0.16
      with:
        required-ros-distributions: ${{ matrix.ros_distribution }}
    - name: Setup
      run: |
        sudo apt install -y python-catkin-tools
        "source /opt/ros/${{ matrix.ros_distribution }}/setup.bash && rosnode --help"
    - name: Build
      run: catkin build
    - name: Test
      run: catkin run_tests && catkin_test_results
